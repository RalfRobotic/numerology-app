<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --btn-color: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #888; font-size: 14px; }
        input, select {
            width: 100%; box-sizing: border-box; padding: 12px;
            border-radius: 10px; border: 1px solid #ddd;
            font-size: 16px; background: var(--secondary); color: var(--text-color);
        }

        .main-btn {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            background: var(--btn-color); color: var(--btn-text);
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 15px;
            text-align: center; margin-bottom: 20px; display: none;
        }
        .res-num { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .res-desc { font-size: 14px; opacity: 0.9; }

        .tabs {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: var(--bg-color); display: flex; border-top: 1px solid #ddd;
        }
        .tab {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: #999; font-size: 12px; cursor: pointer;
        }
        .tab.active { color: var(--btn-color); }
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="p-profile" class="page active">
        <h2>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="input-group">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="birthdate" onchange="calcProfile()">
        </div>
        <div class="input-group">
            <label>–ò–º—è</label>
            <input type="text" id="name" placeholder="–ò–≤–∞–Ω">
        </div>
        <div id="res-profile" class="result-card">
            <div>–ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏</div>
            <div class="res-num" id="val-lp">-</div>
            <div class="res-desc" id="calc-lp"></div>
        </div>
        <button class="main-btn" onclick="sendData('full_analysis')">üîÆ –ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä (AI)</button>
    </div>

    <!-- –ù–û–ú–ï–†–ê -->
    <div id="p-numbers" class="page">
        <h2>üî¢ –ê–Ω–∞–ª–∏–∑ –Ω–æ–º–µ—Ä–æ–≤</h2>
        <div class="input-group">
            <select id="num-type">
                <option value="phone">üì± –¢–µ–ª–µ—Ñ–æ–Ω</option>
                <option value="car">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                <option value="other">üî¢ –î—Ä—É–≥–æ–µ —á–∏—Å–ª–æ</option>
            </select>
        </div>
        <div class="input-group">
            <input type="text" id="num-val" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä...">
        </div>
        <button class="main-btn" onclick="sendData('any_number')">üìú –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="nav('profile', this)">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="tab" onclick="nav('numbers', this)">üî¢ –ù–æ–º–µ—Ä–∞</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –£–ë–†–ê–õ–ò –ü–†–û–í–ï–†–ö–£ INITDATA, –ß–¢–û–ë–´ –†–ê–ë–û–¢–ê–õ–û –ù–ê MAC

        function sumDigits(str) { return String(str).replace(/\D/g,'').split('').reduce((a,b)=>+a + +b, 0); }
        function reduce(n) { while(n > 9 && n!=11 && n!=22 && n!=33) n = sumDigits(n); return n; }

        function calcProfile() {
            const d = document.getElementById('birthdate').value;
            if(!d) return;
            const [y,m,day] = d.split('-');
            const total = sumDigits(y) + sumDigits(m) + sumDigits(day);
            const res = reduce(total);
            document.getElementById('val-lp').innerText = res;
            document.getElementById('calc-lp').innerText = `${sumDigits(day)} + ${sumDigits(m)} + ${sumDigits(y)} = ${total}`;
            document.getElementById('res-profile').style.display = 'block';
        }

        function nav(page, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-'+page).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function sendData(action) {
            // –ú–´ –£–ë–†–ê–õ–ò –ó–î–ï–°–¨ –ü–†–û–í–ï–†–ö–£ INITDATA
            // –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–º–µ—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
            
            let data = { action: action };
            if (action === 'full_analysis') {
                const date = document.getElementById('birthdate').value;
                if (!date) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!");
                data.date = date.split('-').reverse().join('.'); 
                data.name = document.getElementById('name').value;
            } else if (action === 'any_number') {
                const val = document.getElementById('num-val').value;
                if (!val) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä!");
                data.number = val;
                data.type = document.getElementById('num-type').value;
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
