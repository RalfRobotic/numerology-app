<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --btn-color: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è */
        #warning-card {
            background: #ffebeb;
            color: #d32f2f;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            border: 1px solid #ffcdd2;
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #888; font-size: 14px; }
        input, select {
            width: 100%; box-sizing: border-box; padding: 12px;
            border-radius: 10px; border: 1px solid #ddd;
            font-size: 16px; background: var(--secondary); color: var(--text-color);
        }

        .main-btn {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            background: var(--btn-color); color: var(--btn-text);
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 15px;
            text-align: center; margin-bottom: 20px; display: none;
        }
        .res-num { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .res-desc { font-size: 14px; opacity: 0.9; }

        /* –¢–∞–±—ã */
        .tabs {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: var(--bg-color); display: flex; border-top: 1px solid #ddd;
        }
        .tab {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: #999; font-size: 12px; cursor: pointer;
        }
        .tab.active { color: var(--btn-color); }
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

    <div id="warning-card">
        ‚ö†Ô∏è <b>–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞!</b><br>
        –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ.<br>
        –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É <b>¬´–ú–µ–Ω—é¬ª</b> –≤ –±–æ—Ç–µ, –∏–Ω–∞—á–µ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç!
    </div>

    <!-- –°–¢–†–ê–ù–ò–¶–ê 1: –ü–†–û–§–ò–õ–¨ -->
    <div id="p-profile" class="page active">
        <h2>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="input-group">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="birthdate" onchange="calcProfile()">
        </div>
        <div class="input-group">
            <label>–ò–º—è</label>
            <input type="text" id="name" placeholder="–ò–≤–∞–Ω">
        </div>

        <div id="res-profile" class="result-card">
            <div>–ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏</div>
            <div class="res-num" id="val-lp">-</div>
            <div class="res-desc" id="calc-lp"></div>
        </div>

        <button class="main-btn" onclick="sendData('full_analysis')">üîÆ –ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä (AI)</button>
    </div>

    <!-- –°–¢–†–ê–ù–ò–¶–ê 2: –ù–û–ú–ï–†–ê -->
    <div id="p-numbers" class="page">
        <h2>üî¢ –ê–Ω–∞–ª–∏–∑ –Ω–æ–º–µ—Ä–æ–≤</h2>
        <div class="input-group">
            <select id="num-type">
                <option value="phone">üì± –¢–µ–ª–µ—Ñ–æ–Ω</option>
                <option value="car">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                <option value="other">üî¢ –î—Ä—É–≥–æ–µ —á–∏—Å–ª–æ</option>
            </select>
        </div>
        <div class="input-group">
            <input type="text" id="num-val" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä...">
        </div>
        <button class="main-btn" onclick="sendData('any_number')">üìú –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <!-- –¢–ê–ë–´ -->
    <div class="tabs">
        <div class="tab active" onclick="nav('profile', this)">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="tab" onclick="nav('numbers', this)">üî¢ –ù–æ–º–µ—Ä–∞</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
        if (!tg.initData) {
            document.getElementById('warning-card').style.display = 'block';
        }

        // === –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê ===
        function sumDigits(str) {
            return String(str).replace(/\D/g,'').split('').reduce((a,b)=>+a + +b, 0);
        }
        function reduce(n) {
            while(n > 9 && n!=11 && n!=22 && n!=33) n = sumDigits(n);
            return n;
        }

        // === –õ–û–ì–ò–ö–ê ===
        function calcProfile() {
            const d = document.getElementById('birthdate').value;
            if(!d) return;
            const [y,m,day] = d.split('-');
            const total = sumDigits(y) + sumDigits(m) + sumDigits(day);
            const res = reduce(total);
            
            document.getElementById('val-lp').innerText = res;
            document.getElementById('calc-lp').innerText = `${sumDigits(day)} + ${sumDigits(m)} + ${sumDigits(y)} = ${total}`;
            document.getElementById('res-profile').style.display = 'block';
        }

        function nav(page, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-'+page).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        // === –û–¢–ü–†–ê–í–ö–ê ===
        function sendData(action) {
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –∫—Ä–∏–≤–æ - —Ä—É–≥–∞–µ–º—Å—è
            if (!tg.initData) {
                tg.showAlert("–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –ú–µ–Ω—é –≤ –±–æ—Ç–µ!");
                return;
            }

            let data = { action: action };

            if (action === 'full_analysis') {
                const date = document.getElementById('birthdate').value;
                if (!date) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!");
                // –ü–µ—Ä–µ–≤–æ–¥ YYYY-MM-DD -> DD.MM.YYYY
                data.date = date.split('-').reverse().join('.'); 
                data.name = document.getElementById('name').value;
            } 
            else if (action === 'any_number') {
                const val = document.getElementById('num-val').value;
                if (!val) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä!");
                data.number = val;
                data.type = document.getElementById('num-type').value;
            }

            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
