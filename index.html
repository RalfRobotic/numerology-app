<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #000);
            --hint-color: var(--tg-theme-hint-color, #999);
            --button-color: var(--tg-theme-button-color, #3390ec);
            --button-text-color: var(--tg-theme-button-text-color, #fff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --card-bg: var(--tg-theme-section-bg-color, #ffffff);
            --header-bg: var(--tg-theme-header-bg-color, #f0f0f0);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 90px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¢–∞–±—ã) */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: var(--secondary-bg);
            border-top: 1px solid var(--hint-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--hint-color);
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            width: 25%;
        }

        .tab-btn.active {
            color: var(--button-color);
        }

        .tab-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .page {
            display: none;
            padding: 16px;
            animation: fadeIn 0.3s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h2 { margin-top: 10px; margin-bottom: 20px; font-size: 22px; }
        h3 { font-size: 18px; margin: 15px 0 10px; }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 13px;
            color: var(--hint-color);
            margin-bottom: 6px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-color);
            box-sizing: border-box;
            outline: none;
        }
        
        input:focus { border-color: var(--button-color); }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .result-card {
            background: var(--secondary-bg);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            border: 1px solid transparent;
        }

        .result-card.highlight {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }
        
        .result-card.highlight .label { color: rgba(255,255,255,0.8); }
        .result-card.highlight .calc { color: rgba(255,255,255,0.7); }

        .result-num {
            font-size: 32px;
            font-weight: 700;
            margin: 5px 0;
        }

        .result-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--hint-color);
        }

        .result-calc {
            font-size: 10px;
            color: var(--hint-color);
            margin-top: 4px;
        }
        
        /* –ú–µ—Ç–∫–∏ –ú–∞—Å—Ç–µ—Ä/–ö–∞—Ä–º–∞ */
        .badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        .badge-master { background: #ffd700; color: #000; }
        .badge-karmic { background: #ff4757; color: #fff; }

        .main-btn {
            width: 100%;
            padding: 16px;
            background-color: var(--button-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        
        .main-btn:active { transform: scale(0.98); }

        .details-box {
            background: var(--secondary-bg);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 13px;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 5px;
        }
        .detail-row:last-child { border: none; margin: 0; padding: 0; }
    </style>
</head>
<body>

    <!-- –°–¢–†–ê–ù–ò–¶–ê 1: –õ–ò–ß–ù–û–°–¢–¨ (Life Path, Soul, Name, Personal Year) -->
    <div id="page-personal" class="page active">
        <h2>üë§ –õ–∏—á–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</h2>
        
        <div class="input-group">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="birthdate" onchange="calcPersonal()">
        </div>

        <div class="input-group">
            <label>–ü–æ–ª–Ω–æ–µ –∏–º—è (–§–ò–û)</label>
            <input type="text" id="fullname" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" oninput="calcPersonal()">
        </div>

        <div id="personal-results" style="display:none;">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∏–¥ -->
            <div class="result-grid">
                <!-- –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å -->
                <div class="result-card highlight">
                    <div class="result-label">–ü—É—Ç—å (–°—É–¥—å–±–∞)</div>
                    <div class="result-num" id="lp-num">-</div>
                    <div class="result-calc" id="lp-calc"></div>
                    <div id="lp-badge"></div>
                </div>

                <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–¥ -->
                <div class="result-card">
                    <div class="result-label">–õ–∏—á–Ω—ã–π –≥–æ–¥</div>
                    <div class="result-num" id="py-num">-</div>
                    <div class="result-calc" id="py-year"></div>
                    <div id="py-badge"></div>
                </div>
            </div>

            <div class="result-grid">
                <!-- –î—É—à–∞ -->
                <div class="result-card">
                    <div class="result-label">–ß–∏—Å–ª–æ –î—É—à–∏</div>
                    <div class="result-num" id="soul-num">-</div>
                    <div id="soul-badge"></div>
                </div>

                <!-- –ò–º—è -->
                <div class="result-card">
                    <div class="result-label">–ß–∏—Å–ª–æ –ò–º–µ–Ω–∏</div>
                    <div class="result-num" id="name-num">-</div>
                    <div id="name-badge"></div>
                </div>
            </div>

            <button class="main-btn" onclick="sendAction('full_analysis')">üîÆ –ü–æ–ª–Ω–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞</button>
        </div>
    </div>

    <!-- –°–¢–†–ê–ù–ò–¶–ê 2: –ê–í–¢–û/–¢–ï–õ–ï–§–û–ù (–°–ª–æ–∂–Ω—ã–π –∞–Ω–∞–ª–∏–∑) -->
    <div id="page-numbers" class="page">
        <h2>üî¢ –ê–Ω–∞–ª–∏–∑ –Ω–æ–º–µ—Ä–∞</h2>
        
        <div class="input-group">
            <label>–¢–∏–ø –Ω–æ–º–µ—Ä–∞</label>
            <select id="num-type" onchange="uiUpdateNumType()">
                <option value="any">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ</option>
                <option value="car">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                <option value="phone">üì± –¢–µ–ª–µ—Ñ–æ–Ω</option>
                <option value="apartment">üè† –ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–æ–º</option>
            </select>
        </div>

        <div class="input-group">
            <label id="num-label">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ</label>
            <input type="text" id="arbitrary-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 777" oninput="calcArbitrary()">
        </div>

        <div id="arb-result" style="display:none;">
            <div class="result-card highlight">
                <div class="result-label">–ò—Ç–æ–≥–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è</div>
                <div class="result-num" id="arb-total">-</div>
                <div class="result-calc" id="arb-calc"></div>
                <div id="arb-badge"></div>
            </div>

            <!-- –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∞–≤—Ç–æ/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
            <div id="arb-details" class="details-box" style="display:none;">
                <div class="result-label" style="text-align:center; margin-bottom:10px;">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</div>
                <div id="arb-details-content"></div>
            </div>

            <button class="main-btn" onclick="sendAction('any_number')">üìú –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
        </div>
    </div>

    <!-- –°–¢–†–ê–ù–ò–¶–ê 3: –°–û–ë–´–¢–ò–Ø -->
    <div id="page-events" class="page">
        <h2>üìÖ –î–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π</h2>
        <div class="input-group">
            <label>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
            <select id="event-type">
                <option value="wedding">üíí –°–≤–∞–¥—å–±–∞</option>
                <option value="business">üíº –ë–∏–∑–Ω–µ—Å</option>
                <option value="moving">üè° –ü–µ—Ä–µ–µ–∑–¥</option>
                <option value="contract">üìù –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>–î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è</label>
            <input type="date" id="event-date" onchange="calcEvent()">
        </div>

        <div id="event-result" style="display:none;">
            <div class="result-card highlight" style="background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);">
                <div class="result-label">–ß–∏—Å–ª–æ —Å–æ–±—ã—Ç–∏—è</div>
                <div class="result-num" id="event-num">-</div>
                <div class="result-calc" id="event-calc"></div>
            </div>
            <button class="main-btn" onclick="sendAction('event_date')">üåü –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –¥–∞—Ç—É</button>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('personal', this)">
            <span class="tab-icon">üë§</span>–ü—Ä–æ—Ñ–∏–ª—å
        </button>
        <button class="tab-btn" onclick="switchTab('numbers', this)">
            <span class="tab-icon">üî¢</span>–ù–æ–º–µ—Ä–∞
        </button>
        <button class="tab-btn" onclick="switchTab('events', this)">
            <span class="tab-icon">üìÖ</span>–°–æ–±—ã—Ç–∏—è
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ==========================================
        // –õ–û–ì–ò–ö–ê –ù–£–ú–ï–†–û–õ–û–ì–ò–ò (1 –≤ 1 —Å Python)
        // ==========================================

        const MASTER_NUMBERS = [11, 22, 33];
        const KARMIC_NUMBERS = [13, 14, 16, 19];

        const RUSSIAN_ALPHABET = {
            '–ê': 1, '–ò': 1, '–°': 1, '–™': 1,
            '–ë': 2, '–ô': 2, '–¢': 2, '–´': 2,
            '–í': 3, '–ö': 3, '–£': 3, '–¨': 3,
            '–ì': 4, '–õ': 4, '–§': 4, '–≠': 4,
            '–î': 5, '–ú': 5, '–•': 5, '–Æ': 5,
            '–ï': 6, '–ù': 6, '–¶': 6, '–Ø': 6,
            '–Å': 7, '–û': 7, '–ß': 7,
            '–ñ': 8, '–ü': 8, '–®': 8,
            '–ó': 9, '–†': 9, '–©': 9
        };
        
        const ENGLISH_ALPHABET = {
            'A': 1, 'J': 1, 'S': 1,
            'B': 2, 'K': 2, 'T': 2,
            'C': 3, 'L': 3, 'U': 3,
            'D': 4, 'M': 4, 'V': 4,
            'E': 5, 'N': 5, 'W': 5,
            'F': 6, 'O': 6, 'X': 6,
            'G': 7, 'P': 7, 'Y': 7,
            'H': 8, 'Q': 8, 'Z': 8,
            'I': 9, 'R': 9
        };

        // --- –£—Ç–∏–ª–∏—Ç—ã ---

        // –†–µ–¥—É–∫—Ü–∏—è —Å —É—á–µ—Ç–æ–º –ú–∞—Å—Ç–µ—Ä-—á–∏—Å–µ–ª
        function reduceToSingle(num) {
            let n = parseInt(num);
            while (n > 9) {
                if (MASTER_NUMBERS.includes(n)) return n;
                n = String(n).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            return n;
        }

        // –ü–æ–¥—Å—á–µ—Ç —Å—É–º–º—ã —Ü–∏—Ñ—Ä
        function sumDigits(str) {
            return String(str).replace(/\D/g, '').split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞—Ä–º—É
        function checkKarma(num) {
            return KARMIC_NUMBERS.includes(num);
        }

        // --- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã ---

        function calculateLifePath(dateStr) {
            // YYYY-MM-DD
            const [year, month, day] = dateStr.split('-');
            const dSum = sumDigits(day);
            const mSum = sumDigits(month);
            const ySum = sumDigits(year);
            const total = dSum + mSum + ySum;
            
            return {
                number: reduceToSingle(total),
                calc: `${dSum} + ${mSum} + ${ySum} = ${total}`,
                karmic: checkKarma(total)
            };
        }

        function calculateName(fullName) {
            let total = 0;
            const cleanName = fullName.toUpperCase().replace(/[^–ê-–Ø–ÅA-Z]/g, '');
            
            for (let char of cleanName) {
                if (RUSSIAN_ALPHABET[char]) total += RUSSIAN_ALPHABET[char];
                else if (ENGLISH_ALPHABET[char]) total += ENGLISH_ALPHABET[char];
            }

            return {
                number: reduceToSingle(total),
                karmic: checkKarma(total)
            };
        }

        function calculatePersonalYear(dateStr) {
            const [_, month, day] = dateStr.split('-');
            const currentYear = new Date().getFullYear();
            
            // –î–µ–Ω—å + –ú–µ—Å—è—Ü + –¢–µ–∫—É—â–∏–π –ì–æ–¥
            const total = parseInt(day) + parseInt(month) + sumDigits(currentYear);
            
            return {
                number: reduceToSingle(total),
                year: currentYear
            };
        }

        // –°–ª–æ–∂–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –∞–≤—Ç–æ/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∏–∑ Python _detailed_number_analysis)
        function analyzeDetailed(input, type) {
            const digitsOnly = input.replace(/\D/g, '');
            if (!digitsOnly) return null;

            // –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
            const totalSum = sumDigits(digitsOnly);
            const result = {
                total: reduceToSingle(totalSum),
                calc: [...digitsOnly].join('+') + ` = ${totalSum}`,
                parts: []
            };

            // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
            if (type === 'car') {
                // –ò—â–µ–º –≥—Ä—É–ø–ø—ã —Ü–∏—Ñ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä –ê 123 –í–í 77)
                const groups = input.match(/\d+/g);
                if (groups && groups.length >= 2) {
                    const main = groups[0]; // –ù–æ–º–µ—Ä
                    const region = groups[groups.length - 1]; // –†–µ–≥–∏–æ–Ω

                    const mainSum = sumDigits(main);
                    const regSum = sumDigits(region);

                    result.parts.push({ name: '–ù–æ–º–µ—Ä', val: main, res: reduceToSingle(mainSum) });
                    result.parts.push({ name: '–†–µ–≥–∏–æ–Ω', val: region, res: reduceToSingle(regSum) });
                }
            } else if (type === 'phone') {
                // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –¥–ª–∏–Ω–Ω—ã–π (>10 —Ü–∏—Ñ—Ä)
                if (digitsOnly.length >= 10) {
                    const mainPart = digitsOnly.slice(-7); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7
                    const codePart = digitsOnly.slice(digitsOnly.length - 10, digitsOnly.length - 7); // –ö–æ–¥

                    const mainSum = sumDigits(mainPart);
                    const codeSum = sumDigits(codePart);

                    result.parts.push({ name: '–¢–µ–ª–æ –Ω–æ–º–µ—Ä–∞', val: `...${mainPart}`, res: reduceToSingle(mainSum) });
                    result.parts.push({ name: '–ö–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞', val: codePart, res: reduceToSingle(codeSum) });
                }
            }

            return result;
        }

        // ==========================================
        // UI FUNCTIONS
        // ==========================================

        function switchTab(name, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('page-' + name).classList.add('active');
            btn.classList.add('active');
        }

        // –†–µ–Ω–¥–µ—Ä –±–µ–π–¥–∂–µ–π (–ú–∞—Å—Ç–µ—Ä/–ö–∞—Ä–º–∞)
        function renderBadges(containerId, num, isKarmic) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (MASTER_NUMBERS.includes(num)) {
                container.innerHTML += '<span class="badge badge-master">MASTER</span>';
            }
            if (isKarmic) {
                container.innerHTML += '<span class="badge badge-karmic">KARMA</span>';
            }
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –õ–∏—á–Ω–æ—Å—Ç–∏
        function calcPersonal() {
            const dateVal = document.getElementById('birthdate').value;
            const nameVal = document.getElementById('fullname').value;
            const resDiv = document.getElementById('personal-results');

            if (!dateVal) {
                resDiv.style.display = 'none';
                return;
            }

            // 1. Life Path
            const lp = calculateLifePath(dateVal);
            document.getElementById('lp-num').innerText = lp.number;
            document.getElementById('lp-calc').innerText = lp.calc;
            renderBadges('lp-badge', lp.number, lp.karmic);

            // 2. Soul (Day)
            const day = parseInt(dateVal.split('-')[2]);
            const soulNum = reduceToSingle(day);
            document.getElementById('soul-num').innerText = soulNum;
            renderBadges('soul-badge', soulNum, false);

            // 3. Personal Year
            const py = calculatePersonalYear(dateVal);
            document.getElementById('py-num').innerText = py.number;
            document.getElementById('py-year').innerText = `–ì–æ–¥: ${py.year}`;
            renderBadges('py-badge', py.number, false);

            // 4. Name
            if (nameVal.length > 2) {
                const nn = calculateName(nameVal);
                document.getElementById('name-num').innerText = nn.number;
                renderBadges('name-badge', nn.number, nn.karmic);
            } else {
                document.getElementById('name-num').innerText = '-';
            }

            resDiv.style.display = 'block';
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ù–æ–º–µ—Ä–æ–≤
        function uiUpdateNumType() {
            const type = document.getElementById('num-type').value;
            const input = document.getElementById('arbitrary-input');
            const label = document.getElementById('num-label');
            
            input.value = '';
            document.getElementById('arb-result').style.display = 'none';

            if (type === 'car') {
                label.innerText = '–ù–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê 777 –ê–ê 77)';
            } else if (type === 'phone') {
                label.innerText = '–¢–µ–ª–µ—Ñ–æ–Ω (–±–µ–∑ +7/8)';
            } else {
                label.innerText = '–õ—é–±–æ–µ —á–∏—Å–ª–æ';
            }
        }

        function calcArbitrary() {
            const val = document.getElementById('arbitrary-input').value;
            const type = document.getElementById('num-type').value;
            
            if (!val) {
                document.getElementById('arb-result').style.display = 'none';
                return;
            }

            const res = analyzeDetailed(val, type);
            if (!res) return;

            document.getElementById('arb-total').innerText = res.total;
            document.getElementById('arb-calc').innerText = res.calc;
            renderBadges('arb-badge', res.total, false);

            // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
            const detailsDiv = document.getElementById('arb-details');
            const contentDiv = document.getElementById('arb-details-content');
            
            if (res.parts.length > 0) {
                detailsDiv.style.display = 'block';
                contentDiv.innerHTML = res.parts.map(p => `
                    <div class="detail-row">
                        <span>${p.name} (${p.val}):</span>
                        <strong>${p.res}</strong>
                    </div>
                `).join('');
            } else {
                detailsDiv.style.display = 'none';
            }

            document.getElementById('arb-result').style.display = 'block';
        }

        // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–æ–±—ã—Ç–∏–π
        function calcEvent() {
            const dateVal = document.getElementById('event-date').value;
            if (!dateVal) {
                document.getElementById('event-result').style.display = 'none';
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É —á—Ç–æ –¥–ª—è Life Path, –Ω–æ –±–µ–∑ –∫–∞—Ä–º–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
            const [y, m, d] = dateVal.split('-');
            const total = sumDigits(y) + sumDigits(m) + sumDigits(d);
            const num = reduceToSingle(total);

            document.getElementById('event-num').innerText = num;
            document.getElementById('event-calc').innerText = `${sumDigits(d)} + ${sumDigits(m)} + ${sumDigits(y)}`;
            document.getElementById('event-result').style.display = 'block';
        }

        // ==========================================
        // –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• –í –ë–û–¢–ê
        // ==========================================

        function sendAction(actionType) {
            let data = { action: actionType };

            if (actionType === 'full_analysis') {
                const dateVal = document.getElementById('birthdate').value;
                if (!dateVal) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è!");
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ DD.MM.YYYY
                const [y, m, d] = dateVal.split('-');
                data.date = `${d}.${m}.${y}`;
                data.name = document.getElementById('fullname').value || "";
            } 
            else if (actionType === 'any_number') {
                const val = document.getElementById('arbitrary-input').value;
                if (!val) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä!");
                
                data.number = val;
                data.type = document.getElementById('num-type').value;
            }
            else if (actionType === 'event_date') {
                const dateVal = document.getElementById('event-date').value;
                if (!dateVal) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!");
                
                const [y, m, d] = dateVal.split('-');
                data.date = `${d}.${m}.${y}`;
                data.event_type = document.getElementById('event-type').value;
            }

            tg.sendData(JSON.stringify(data));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.ready();
    </script>
</body>
</html>
