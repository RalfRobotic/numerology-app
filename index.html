<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DEBUG MODE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; padding-bottom: 200px; }
        input { display: block; width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: blue; color: white; border: none; font-size: 18px; border-radius: 8px; }
        
        /* –ö–û–ù–°–û–õ–¨ –û–¢–õ–ê–î–ö–ò */
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: black;
            color: lime;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            overflow-y: scroll;
            z-index: 9999;
            border-top: 2px solid red;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

    <h1>üõ† –¢–ï–°–¢ –û–¢–ü–†–ê–í–ö–ò</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É:</p>
    
    <input type="date" id="test-date">
    <button onclick="trySend()">–û–¢–ü–†–ê–í–ò–¢–¨ –î–ê–ù–ù–´–ï</button>

    <!-- –û–∫–Ω–æ –ª–æ–≥–æ–≤ -->
    <div id="debug-console">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...<br></div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–≥–µ—Ä - –ø–∏—à–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω
        function log(msg) {
            const consoleDiv = document.getElementById('debug-console');
            const time = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `[${time}] ${msg}<br>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight; // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
        }

        const tg = window.Telegram.WebApp;

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        log("üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω");
        
        if (window.Telegram) {
            log("‚úÖ Telegram –æ–±—ä–µ–∫—Ç –Ω–∞–π–¥–µ–Ω");
        } else {
            log("‚ùå Telegram –æ–±—ä–µ–∫—Ç –ù–ï –Ω–∞–π–¥–µ–Ω");
        }

        tg.expand();
        log("üìä InitData: " + (tg.initData ? "–ï–°–¢–¨ (–û–ö)" : "–ü–£–°–¢–û (–û–®–ò–ë–ö–ê)"));
        
        if (!tg.initData) {
            log("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: initData –ø—É—Å—Ç–∞—è! sendData –ù–ï —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.");
            log("–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ? –ù—É–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –ú–µ–Ω—é!");
        }

        function trySend() {
            log("üëâ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞...");
            
            const dateVal = document.getElementById('test-date').value;
            if (!dateVal) {
                log("‚ùå –î–∞—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞");
                return;
            }

            const data = {
                action: 'full_analysis',
                date: dateVal.split('-').reverse().join('.'), // YYYY-MM-DD -> DD.MM.YYYY
                name: "–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á"
            };

            const jsonStr = JSON.stringify(data);
            log("üì¶ –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã: " + jsonStr);

            try {
                log("üì° –í—ã–∑—ã–≤–∞—é tg.sendData()...");
                tg.sendData(jsonStr);
                log("‚úÖ sendData –≤—ã–∑–≤–∞–Ω–∞ (–æ–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è)");
            } catch (e) {
                log("üî• CRITICAL ERROR: " + e.message);
                log("Stack: " + e.stack);
            }
        }
    </script>
</body>
</html>
